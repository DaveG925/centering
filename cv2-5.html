<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Card Centering Tool</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/4.5.0/fabric.min.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #FFFFFF;
        }

        canvas {
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>

<canvas id="canvas"></canvas>

<script>
    const canvas = new fabric.Canvas('canvas', { selection: false });
    const controlPointOffset = 30; // Global offset for the control points

    function debounce(func, wait) {
        let timeout;
        return function () {
            const context = this, args = arguments;
            clearTimeout(timeout);
            timeout = setTimeout(() => func.apply(context, args), wait);
        };
    }

    function adjustCanvas() {
        const horizontalPadding = 20; // 20px on each side
        const verticalPadding = 20; // 50px on top and bottom for example
        const canvasWidth = window.innerWidth - horizontalPadding;
        const canvasHeight = window.innerHeight - verticalPadding - 50; // Deduct space for the button

        // Set canvas dimensions
        canvas.setWidth(canvasWidth);
        canvas.setHeight(canvasHeight);

        // Center the overlay image
        if (window.loadedImage) {
            const img = window.loadedImage;
            img.set({
                left: (canvasWidth - img.width) / 2,
                top: (canvasHeight - img.height) / 2
            });
            canvas.renderAll();
        }
    }

    function loadImage(imageURL) {
        fabric.Image.fromURL(imageURL, function (img) {
            window.loadedImage = img;
            adjustCanvas(); // Adjust canvas dimensions and center image
            img.selectable = false;
            canvas.add(img);
            img.sendToBack();
        });
    }

    function overlayImageInCenter() {
        fabric.Image.fromURL('https://raw.githubusercontent.com/DaveG925/centering/main/centering2.png', function (overlayImg) {
            console.log('Image loaded:', overlayImg);

            const canvasWidth = canvas.getWidth();
            const canvasHeight = canvas.getHeight();

            // Center the overlay image
            overlayImg.set({
                left: (canvasWidth - overlayImg.width) / 2,
                top: (canvasHeight - overlayImg.height) / 2,
                hasControls: false, // Disable fabric.js controls for the overlay image
                selectable: false // Make the overlay image non-selectable
            });

            canvas.add(overlayImg);
            canvas.renderAll();
        });
    }

    window.addEventListener('resize', debounce(adjustCanvas, 100));

    window.onload = function () {
        const urlParams = new URLSearchParams(window.location.search);
        const imageURL = urlParams.get('imageURL') || 'your-default-image-url.jpg';
        adjustCanvas();
        loadImage(imageURL);
        overlayImageInCenter(); // Add overlay image centered in the canvas
    };
</script>
</body>
</html>
