<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <style>
        body {
            margin: 20;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 95vh;
            background-color: #f7f7f7;
        }
        canvas {
            border: 1px solid #ccc;
            max-width: 90%;
            max-height: 95vh; /* Maintain aspect ratio and fit screen */
            box-sizing: border-box;
        }
    </style>
    <title>Canvas with Adjustable Crossing Lines and Axis-Locked Handles</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/4.5.0/fabric.min.js"></script>
</head>
<body>

<canvas id="canvas"></canvas>

<script>
     window.onload = function() {
        // Load image from URL
        fabric.Image.fromURL('https://via.placeholder.com/150', function(img) {
            // Scale the image to fit within the canvas while maintaining aspect ratio
            const scaleFactor = Math.min(canvas.width / img.width, canvas.height / img.height);
            img.scale(scaleFactor);

            // Calculate the position to center the image on the canvas
            const leftPosition = (canvas.width - img.width * scaleFactor) / 2;
            const topPosition = (canvas.height - img.height * scaleFactor) / 2;

            // Set the image's position and make it non-selectable
            img.set({
                left: leftPosition,
                top: topPosition,
                selectable: false
            });

            // Add the image to the canvas
            canvas.add(img);

            // Add handles after the image
            addHandles();
        });
        
        updateLines();
        window.addEventListener('resize', adjustCanvas);
        adjustCanvas(); // Initial setup
    };

    function addHandles() {
        const handles = {
            top1: createHandle(0.15, 0, true),
            top2: createHandle(0.85, 0, true),
            right1: createHandle(1, 0.15, false),
            right2: createHandle(1, 0.6, false),
            bottom1: createHandle(0.15, 1, true),
            bottom2: createHandle(0.85, 1, true),
            left1: createHandle(0, 0.15, false),
            left2: createHandle(0, 0.6, false),
        };
    }

    // Function to create handles
    function createHandle(xRatio, yRatio, horizontalLock) {
        const handle = new fabric.Circle({
            left: canvas.width * xRatio,
            top: canvas.height * yRatio,
            fill: 'blue',
            radius: 25,
            originX: 'center',
            originY: 'center',
            hasBorders: false,
            hasControls: false,
            selectable: true,
        });

        handle.on('moving', function() {
            if (horizontalLock) {
                this.set('top', canvas.height * yRatio);
            } else {
                this.set('left', canvas.width * xRatio);
            }
            updateLines();
        });

        canvas.add(handle);
        return handle;
    }
</script>

</body>
</html>
